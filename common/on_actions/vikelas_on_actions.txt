######################
# VIKELAS ON ACTIONS #
######################

#by Marco Dandolo & Lord R

######################

on_yearly_pulse = { 
	on_actions = {
		vikelas_on_yearly_pulse
	}
}

on_five_year_pulse_country = {
	on_actions = {
		vikelas_five_year_pulse_country
	}
}

on_acquired_technology = {
	on_actions = {
		vikelas_on_acquired_technology
	}
}

vikelas_on_yearly_pulse_country = {
	effect = {
		### Remove Common Sports Modifier if the overlord/power bloc leader does not have the same sport or the country is independent
		if = {
			limit = {
				has_modifier = vikelas_common_national_sports_modifier
				NOR = {
					AND = {
						is_subject = yes
						overlord = {
							NOT = {
								var:vikelas_national_sport_var ?= root.var:vikelas_national_sport_var
							}
						}
					}
					#AND = {
					#	is_in_power_bloc = yes
					#	power_bloc.power_bloc_leader = {
					#		var:vikelas_national_sport_var ?= root.var:vikelas_national_sport_var
					#	}
					#}
					AND = {
						is_subject = no
						#is_in_power_bloc = no
					}
				}
			}
			remove_modifier = vikelas_common_national_sports_modifier
		}
	}
	events = {
		vikelas.110 #Vikelas 110: Olympic Enthusiasm
		vikelas.182 #Vikelas 182: Olympic Torch in $COUNTRY$

		vikelas.301 #Vikelas 301: Cricket Club in $STATE$
		vikelas.302 #Vikelas 302: Baseball Club in $STATE$
		vikelas.303 #Vikelas 303: Football Club in $STATE$
		vikelas.304 #Vikelas 304: Basketball Club in $STATE$

		vikelas.318 #Vikelas 318: Cricket Association
		vikelas.328 #Vikelas 328: Baseball Association
		vikelas.338 #Vikelas 338: Football Association
		vikelas.348 #Vikelas 348: Basketball Association

		vikelas.321 #Vikelas 321: Baseball for Japan and Cuba

		vikelas.394 #Vikelas 394: A Common Sport

		vikelas.571 #Vikelas 571: Le Mans
		vikelas.572 #Vikelas 572: Targa Florio
		vikelas.573 #Vikelas 573: Semmering-Bergrennen
		
		vikelas.591 #Vikelas 591: Racer retires

		vikelas.602 #Vikelas 602: Pedals on the Pavement
	}
}

vikelas_on_yearly_pulse = {
	effect = {
		### FIFA WORLD CUP ###
		if = {
			limit = {
				has_global_variable = vikelas_football_worldcup_global_var
				NOT = {
					has_global_variable = vikelas_recent_football_worldcup_global_var
				}
				any_country = {
					has_variable = vikelas_fifa_founding_country_var
				}
			}
			random_country = {
				limit = {
					has_variable = vikelas_fifa_founding_country_var
				}
				trigger_event = {
					id = vikelas.410
					days = { 100 140 }
				}
			}
		}
		### GRAND PRIX RACES ###
		if = {
			limit = {
				NOR = {
					has_global_variable = vikelas_autoracing_grand_prix_founded_var
					has_global_variable = vikelas_city_race_ongoing_global_var
				}
				any_country = {
					has_variable = vikelas_automobile_club_var
					count >= 5
				}
				any_country = {
					has_variable = vikelas_automobile_club_var
					any_scope_state = {
						is_incorporated = yes
						count >= 2
					}
					NOT = {
						has_modifier = vikelas_city_race_modifier
					}
				}
			}
			set_global_variable = vikelas_city_race_ongoing_global_var
			random_country = {
				limit = {
					has_variable = vikelas_automobile_club_var
					any_scope_state = {
						is_incorporated = yes
						count >= 2
					}
					NOT = {
						has_modifier = vikelas_city_race_modifier
					}
				}

				trigger_event = {
					id = vikelas.511
					days = 32 #1st February
				}
			}
		}
		if = {
			limit = {
				has_global_variable = vikelas_autoracing_grand_prix_founded_var
				has_global_variable = vikelas_autoracing_aiacr_founded_global_var
				any_country = {
					has_variable = vikelas_aiacr_founding_country_var
				}
			}
			random_country = {
				limit = {
					has_variable = vikelas_aiacr_founding_country_var
				}
				trigger_event = {
					id = vikelas.550
				}
			}
		}
	}
}

vikelas_on_monthly_pulse_country = {
	effect = {
		#This effect is used to add mechanical innovation to all countries
		vikelas_monthly_mechanical_innovation_effect = yes
		#Effects to add mechanic progress for engine, safety and body
		vikelas_monthly_engine_mechanic_progress_effect = yes
		vikelas_monthly_safety_mechanic_progress_effect = yes
		vikelas_monthly_body_mechanic_progress_effect = yes
	}
}

vikelas_five_year_pulse_country = {
	effect = {
		#This effect is used to add the alpine heritage to all countries

		if = {
			limit = {
				has_variable = vikelas_fifa_founding_country_var
			}
			trigger_event = {
				id = vikelas.402 #FIFA - New Board (hidden)
			}
		}
	}
	random_events = {
		2 = 0

		1 = vikelas.621 #Vikelas 621: A Champion for the People
		1 = vikelas.622 #Vikelas 622: Blood on the Stones
		1 = vikelas.623 #Vikelas 623: The Stage
		1 = vikelas.624 #Vikelas 624: The Cheater
		1 = vikelas.625 #Vikelas 625: The Rivals
		1 = vikelas.626 #Vikelas 626: Iron and Will
	}
}

vikelas_on_acquired_technology = {
	events = {
		vikelas.601 #Vikelas 601: Pedals on the Pavement
	}
}